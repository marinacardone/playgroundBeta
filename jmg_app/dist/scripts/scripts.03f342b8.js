"use strict";angular.module("wisableApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.materialize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/registration",{templateUrl:"views/registration/registration.html",controller:"RegistrationController"}).when("/subjectpreferences",{templateUrl:"views/registration/subjectpreferences.html",controller:"PreferencesController"}).when("/login",{templateUrl:"views/registration/login.html",controller:"LoginController"}).when("/home",{templateUrl:"views/home.html",controller:"ArticleController"}).when("/article/:articleId",{templateUrl:"views/articles/article.html",controller:"FullArticleController"}).when("/profile",{templateUrl:"views/menuoptions/profile.html",controller:"ProfileController"}).when("/notifications",{templateUrl:"views/menuoptions/notifications.html",controller:"MainController"}).when("/social",{templateUrl:"views/menuoptions/social.html",controller:"MainController"}).when("/interests",{templateUrl:"views/menuoptions/interests.html",controller:"PreferencesController"}).when("/likes",{templateUrl:"views/menuoptions/likes.html",controller:"ProfileController"}).when("/configuration",{templateUrl:"views/menuoptions/configuration.html",controller:"MainController"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).constant("articlesServerProvider","http://python-recommender.herokuapp.com/articles/").constant("usersServerProvider","http://python-recommender.herokuapp.com/users/").constant("toastConfig",{duration:3e3,rounded:"rounded"}),function(a){a.module("ui.materialize",["ui.materialize.toast","ui.materialize.sidenav","ui.materialize.material_select","ui.materialize.dropdown","ui.materialize.inputfield","ui.materialize.input_date","ui.materialize.tabs","ui.materialize.pagination"]),a.module("ui.materialize.toast",[]).constant("toastConfig",{duration:3e3,rounded:"rounded"}).directive("toast",["toastConfig",function(b){return{scope:{message:"@"},link:function(c,d,e){d.bind(e.toast,function(){var d=a.isDefined(c.message)?c.message:"",f=a.isDefined(e.rounded)?b.rounded:null;toast(d,b.duration,f)})}}}]),a.module("ui.materialize.tabs",[]).directive("tabs",[function(){return{link:function(a,b){b.tabs()}}}]),a.module("ui.materialize.sidenav",[]).directive("sidenav",[function(){return{scope:{menuwidth:"@",closeonclick:"@"},link:function(b,c,d){c.sideNav({menuWidth:a.isDefined(b.menuwidth)?b.menuwidth:void 0,edge:d.sidenav?d.sidenav:"left",closeOnClick:a.isDefined(b.closeonclick)?"true"==b.closeonclick:void 0})}}}]),a.module("ui.materialize.material_select",[]).directive("materialSelect",["$compile","$timeout",function(a,b){return{link:function(c,d){d.is("select")&&(a(d.contents())(c),b(function(){d.material_select()}))}}}]),a.module("ui.materialize.dropdown",[]).directive("dropdown",["$compile","$timeout",function(b,c){return{scope:{inDuration:"@",outDuration:"@",constrain_width:"@",hover:"@",alignment:"@",gutter:"@",belowOrigin:"@"},link:function(d,e){b(e.contents())(d),c(function(){e.dropdown({inDuration:a.isDefined(d.inDuration)?d.inDuration:void 0,outDuration:a.isDefined(d.outDuration)?d.outDuration:void 0,constrain_width:a.isDefined(d.constrainWidth)?d.constrain_width:void 0,hover:a.isDefined(d.hover)?d.hover:void 0,alignment:a.isDefined(d.alignment)?d.alignment:void 0,gutter:a.isDefined(d.gutter)?d.gutter:void 0,belowOrigin:a.isDefined(d.belowOrigin)?d.belowOrigin:void 0})})}}}]),a.module("ui.materialize.inputfield",[]).directive("inputField",["$compile","$timeout",function(b,c){return{transclude:!0,scope:{},link:function(b,d){c(function(){a.element(d).find("input").change()})},template:'<div ng-transclude class="input-field"></div>'}}]),a.module("ui.materialize.input_date",[]).directive("inputDate",["$compile","$timeout",function(b,c){var d=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,e=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};return function(f,g,h){var i=d;if(1!==arguments.length||"[object String]"!=Object.prototype.toString.call(f)||/\d/.test(f)||(g=f,f=void 0),f=f?new Date(f):new Date,isNaN(f))throw SyntaxError("invalid date");g=String(i.masks[g]||g||i.masks["default"]),"UTC:"==g.slice(0,4)&&(g=g.slice(4),h=!0);var j=h?"getUTC":"get",k=f[j+"Date"](),l=f[j+"Day"](),m=f[j+"Month"](),n=f[j+"FullYear"](),o=f[j+"Hours"](),p=f[j+"Minutes"](),q=f[j+"Seconds"](),r=f[j+"Milliseconds"](),s=h?0:f.getTimezoneOffset(),t={d:k,dd:e(k),ddd:i.i18n.dayNames[l],dddd:i.i18n.dayNames[l+7],m:m+1,mm:e(m+1),mmm:i.i18n.monthNames[m],mmmm:i.i18n.monthNames[m+12],yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:e(o%12||12),H:o,HH:e(o),M:p,MM:e(p),s:q,ss:e(q),l:e(r,3),L:e(r>99?Math.round(r/10):r),t:12>o?"a":"p",tt:12>o?"am":"pm",T:12>o?"A":"P",TT:12>o?"AM":"PM",Z:h?"UTC":(String(f).match(b)||[""]).pop().replace(c,""),o:(s>0?"-":"+")+e(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:["th","st","nd","rd"][k%10>3?0:(k%100-k%10!=10)*k%10]};return g.replace(a,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();return d.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},d.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(a,b){return d(this,a,b)},{require:"ngModel",scope:{format:"@",formatSubmit:"@",monthsFull:"@",monthsShort:"@",weekdaysFull:"@",weekdaysLetter:"@",today:"=",clear:"=",close:"=",onStart:"&",onRender:"&",onOpen:"&",onClose:"&",onSet:"&",onStop:"&"},link:function(d,e,f,g){g.$formatters.unshift(function(b){if(b){var c=new Date(b);return c.format(a.isDefined(d.format)?d.format:"d mmmm, yyyy")}return null});var h=a.isDefined(d.monthsFull)?d.$eval(d.monthsFull):void 0,i=a.isDefined(d.monthsShort)?d.$eval(d.monthsShort):void 0,j=a.isDefined(d.weekdaysFull)?d.$eval(d.weekdaysFull):void 0,k=a.isDefined(d.weekdaysLetter)?d.$eval(d.weekdaysLetter):void 0;b(e.contents())(d),c(function(){e.pickadate({format:a.isDefined(d.format)?d.format:void 0,formatSubmit:a.isDefined(d.formatSubmit)?d.formatSubmit:void 0,monthsFull:a.isDefined(h)?h:void 0,monthsShort:a.isDefined(i)?i:void 0,weekdaysFull:a.isDefined(j)?j:void 0,weekdaysLetter:a.isDefined(k)?k:void 0,today:a.isDefined(d.today)?d.today:void 0,clear:a.isDefined(d.clear)?d.clear:void 0,close:a.isDefined(d.close)?d.close:void 0,onStart:a.isDefined(d.close)?function(){d.onStart()}:void 0,onRender:a.isDefined(d.close)?function(){d.onRender()}:void 0,onOpen:a.isDefined(d.close)?function(){d.onOpen()}:void 0,onClose:a.isDefined(d.close)?function(){d.onClose()}:void 0,onSet:a.isDefined(d.close)?function(){d.onSet()}:void 0,onStop:a.isDefined(d.close)?function(){d.onStop()}:void 0})})}}}]),a.module("ui.materialize.pagination",[]).directive("pagination",function(){function a(a,b){a.List=[],a.Hide=!1,a.page=parseInt(a.page)||1,a.total=parseInt(a.total)||0,a.dots=a.dots||"...",a.ulClass="pagination",a.adjacent=parseInt(a.adjacent)||2,a.activeClass="active",a.disabledClass="disabled",a.scrollTop=a.$eval(b.scrollTop),a.hideIfEmpty=a.$eval(b.hideIfEmpty)}function b(a,b){a.page>b&&(a.page=b),a.page<=0&&(a.page=1),a.adjacent<=0&&(a.adjacent=2),1>=b&&(a.Hide=a.hideIfEmpty)}function c(a,b){a.page!=b&&(a.page=b,a.paginationAction({page:b}),a.scrollTop&&scrollTo(0,0))}function d(a,b){if(!(1>b)){var d=a.page-1<=0,e=a.page-1<=0?1:a.page-1,f={value:"<",liClass:d?a.disabledClass:"",action:function(){d||c(a,e)}};a.List.push(f)}}function e(a,b){if(!(1>b)){var d=a.page+1>b,e=a.page+1>=b?b:a.page+1,f={value:">",liClass:d?a.disabledClass:"",action:function(){d||c(a,e)}};a.List.push(f)}}function f(a,b,d){var e=0;for(e=a;b>=e;e++){var f={value:e.toString(),liClass:d.page==e?d.activeClass:"waves-effect",action:function(){c(d,this.value)}};d.List.push(f)}}function g(a){a.List.push({value:a.dots})}function h(a,b){f(1,2,a),3!=b&&g(a)}function i(a,b,c){c!=a-2&&g(b),f(a-1,a,b)}function j(c,g){if(c.pageSize&&!(c.pageSize<0)){a(c,g);var j,k=2*c.adjacent,l=Math.ceil(c.total/c.pageSize);if(b(c,l),d(c,l),5+k>l)j=1,f(j,l,c);else{var m;c.page<=1+k?(j=1,m=2+k+(c.adjacent-1),f(j,m,c),i(l,c,m)):l-k>c.page&&c.page>k?(j=c.page-c.adjacent,m=c.page+c.adjacent,h(c,j),f(j,m,c),i(l,c,m)):(j=l-(1+k+(c.adjacent-1)),m=l,h(c,j),f(j,m,c))}e(c,l)}}return{restrict:"EA",scope:{page:"@",pageSize:"@",total:"@",dots:"@",hideIfEmpty:"@",adjacent:"@",scrollTop:"@",paginationAction:"&"},template:'<ul ng-hide="Hide" ng-class="ulClass"> <li ng-class="Item.liClass" ng-click="Item.action()" ng-repeat="Item in List"> <a href> <span ng-bind="Item.value"></span> </a></ul>',link:function(a,b,c){a.$watchCollection("[page, total]",function(){j(a,c)})}}})}(angular),angular.module("wisableApp").controller("MainController",["$scope","$location","Session",function(a,b){a.isCurrentPage=function(a){return a===b.path()},a.currentLocation=b.path(),a.userId=localStorage.wisableUserId,a.userId||b.path("/")}]),angular.module("wisableApp").controller("LoginController",["$scope","$http","$location","Session","usersServerProvider",function(a,b,c,d,e){a.invalidCredentials=!1,a.userLogin=function(d,f){b.get(e+"login/"+d+"/"+f+"/").then(function(b){b.data.success===!0?(localStorage.setItem("wisableUserId",d),mixpanel.track("login",{user:d}),ga("set","&uid",d),ga("send","event","sesion","login",d),c.path("/home")):(a.invalidCredentials=!0,console.log("invalid credentials")),console.log("service response > "+JSON.stringify(b.data.success))},function(a){console.error("Error while fetching liked article"+a)})}}]),angular.module("wisableApp").controller("MainNavigationController",["$scope","$location",function(a,b){$(".button-collapse").sideNav({menuWidth:250,activationWidth:70}),a.isCurrentPage=function(a){return a===b.path()},a.currentLocation=b.path(),a.toggleMenu=function(){a.isCollapsed||$(".overlay").addClass("activeOverlay"),a.isCollapsed=!a.isCollapsed},a.collapseMenu=function(){a.isCollapsed=!1,$(".overlay").removeClass("activeOverlay"),$(".side-nav.fixed").removeClass("showNav")},a.logOut=function(){console.log("adios!!"),localStorage.removeItem("wisableUserId"),$(".overlay").removeClass("activeOverlay"),b.path("/")}}]),angular.module("wisableApp").config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).controller("RegistrationController",["$scope","$http","$location","Session",function(a,b,c){var d="http://python-recommender.herokuapp.com/";a.invalidUser=!1,a.createUser=function(e,f,g){b.get(d+"users/register/"+f+"/"+g+"/").then(function(b){b.data.success===!0?(localStorage.setItem("wisableUserId",f),c.path("/subjectpreferences")):a.invalidUser=!0,console.log("service response > "+JSON.stringify(b.data.success))},function(a){console.error("Error registering user. "+a)}),a.userId=localStorage.wisableUserId},mixpanel.track("registro-inicio"),ga("send","event","signup","inicio")}]),angular.module("wisableApp").controller("ProfileController",["$scope","$http","$location","Session","usersServerProvider",function(a,b,c,d,e){a.userEmail=localStorage.wisableUserId,a.userPassword="",a.updateUser=function(d,f){console.log("registering user > "+a.userEmail+" pass > "+f),b.get(e+"users/register/"+a.userEmail+"/"+f+"/").then(function(b){b.data.success===!0?c.path("/home"):a.invalidUser=!0,console.log("service response > "+JSON.stringify(b.data.success))},function(a){console.error("Error updating user. "+a)}),a.userId=localStorage.wisableUserId},a.userInterests=[{name:"Arte",id:1,isSelected:!1},{name:"Autos",id:2,isSelected:!1},{name:"Música",id:3,isSelected:!0},{name:"Tecnología",id:4,isSelected:!1},{name:"Cocina",id:5,isSelected:!0},{name:"Películas",id:6,isSelected:!0},{name:"Series de TV",id:7,isSelected:!1},{name:"Famosos",id:8,isSelected:!1}],a.editInterest=function(b){var c=a.selectedInterests.indexOf(b);return c>-1?a.selectedInterests.splice(c,1):a.selectedInterests.push(b),a.selectedInterests},a.userLikes=[{articleId:2,articleTitle:"Awesome title",articleAuthor:"Jack Something",articleCategory:"Cine",articleDate:"21/03/2014"},{articleId:3,articleTitle:"Best title",articleAuthor:"Jane Smith",articleCategory:"Tecnología",articleDate:"05/10/2013"}]}]),angular.module("wisableApp").controller("ArticleController",["$scope","$http","$location","Session","articlesServerProvider",function(a,b,c,d,e){a.userId=localStorage.wisableUserId,a.userId?(a.articles,void 0===a.articles&&b.get(e+"home/"+a.userId+"/").then(function(b){a.articles=b.data},function(a){console.error("Error while fetching articles"+a)}),a.likeArticle=function(c){b.get(e+"tastes/like/"+a.userId+"/"+c+"/").then(function(b){Materialize.toast("Me gusta este artículo",2e3),a.likeThisArticle=b.data,mixpanel.track("rate-positive",{article:c}),ga("send","event","button","rate","positive")},function(a){console.error("Error while fetching liked article"+a)})},a.unlikeArticle=function(c){b.get(e+"tastes/dislike/"+a.userId+"/"+c+"/").then(function(b){Materialize.toast("NO me gusta este artículo",2e3),a.unlikeThisArticle=b.data,mixpanel.track("rate-negative",{article:c}),ga("send","event","button","rate","negative")},function(a){console.error("Error while fetching disliked article"+a)})}):c.path("/")}]),angular.module("wisableApp").controller("FullArticleController",["$scope","$http","$location","Session","articlesServerProvider",function(a,b,c,d,e){a.articleId=c.path().slice(9),a.userId=localStorage.wisableUserId,b.get(e+"details/"+a.userId+"/"+a.articleId+"/").then(function(b){a.fullArticle=b.data},function(a){console.error("Error while fetching article"+a)}),mixpanel.track("view",{article:a.articleId}),ga("send","event","view",a.articleId),a.likeArticle=function(){b.get(e+"tastes/like/"+a.userId+"/"+a.articleId+"/").then(function(b){Materialize.toast("Me gusta este artículo",2e3),a.likeThisArticle=b.data,mixpanel.track("rate-positive",{article:a.articleId}),ga("send","event","button","rate","positive")},function(a){console.error("Error while fetching liked article"+a)})},a.unlikeArticle=function(){b.get(e+"tastes/dislike/"+a.userId+"/"+a.articleId+"/").then(function(b){Materialize.toast("NO me gusta este artículo",2e3),a.unlikeThisArticle=b.data,mixpanel.track("rate-negative",{article:a.articleId}),ga("send","event","button","rate","negative")},function(a){console.error("Error while fetching liked article"+a)})},a.showBack=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1}]),angular.module("wisableApp").config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).controller("PreferencesController",["$scope","$http","$location","Session",function(a,b,c){a.userId=localStorage.wisableUserId;var d="http://python-recommender.herokuapp.com/";a.userId?(a.interests=[{keyword:"política"},{keyword:"actualidad"},{keyword:"moda"},{keyword:"deportes"},{keyword:"fútbol"},{keyword:"decoración"},{keyword:"tecnología"},{keyword:"manualidades"},{keyword:"economía"},{keyword:"música"},{keyword:"diseño"},{keyword:"juegos"},{keyword:"maternidad"},{keyword:"cine"}],a.addPreferences=function(){var b=new Date,d=b.toLocaleString();mixpanel.identify("13487"),mixpanel.people.set({$first_name:"Joe",$last_name:"Doe",$created:d,$email:a.userId}),mixpanel.track("registro-completo"),ga("send","event","sesion","signup",a.userId),c.path("/home")},a.selectedInterests=[],a.modifyInterest=function(c){var e=a.selectedInterests.indexOf(c);return e>-1?(a.selectedInterests.splice(e,1),b.get(d+"tags/interests/remove/"+localStorage.wisableUserId+"/"+c+"/").then(function(a){console.log("removed: "+a.data)},function(a){console.error("Error while removing tag. "+a)})):(a.selectedInterests.push(c),b.get(d+"tags/interests/add/"+localStorage.wisableUserId+"/"+c+"/").then(function(a){console.log("added: "+a.data)},function(a){console.error("Error while adding tag. "+a)})),a.selectedInterests}):c.path("/")}]),angular.module("wisableApp").directive("navbar",function(){return{restrict:"E",templateUrl:"views/mainnav.html",controller:"MainNavigationController",replace:!0}}),angular.module("wisableApp").directive("articleShort",function(){return{restrict:"E",templateUrl:"views/articles/article_short.html",controller:"ArticleController",replace:!0}}),angular.module("wisableApp").directive("toggleClass",function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){b.toggleClass(c.toggleClass)})}}}),angular.module("wisableApp").directive("compareValues",function(){return{require:"ngModel",link:function(a,b,c,d){return c.compareValues?(a.$watch(c.compareValues,function(a){void 0!==d.$viewValue&&""!==d.$viewValue&&d.$setValidity("compareValues",a===d.$viewValue)}),void d.$parsers.push(function(b){if(void 0===b||""===b)return d.$setValidity("compareValues",!0),b;var e=b===a.$eval(c.compareValues);return d.$setValidity("compareValues",e),e?b:void 0})):void console.error("compareValues expects a model as an argument!")}}}),angular.module("wisableApp").directive("preloader",function(){return{restrict:"E",templateUrl:"views/preloader.html",controller:"ArticleController",replace:!0}});var wisable=angular.module("wisableApp");wisable.service("Session",function(){return this.create=function(a){this.userId=a},this.destroy=function(){this.userId=null},this});var wisable=angular.module("wisableApp");wisable.filter("decodeURIComponent",function(){return window.decodeURIComponent}),wisable.filter("newlines",function(){return function(a){var b="<p>";return b+=a.replace(/\n/g,"</p><p>"),b+="</p>"}});